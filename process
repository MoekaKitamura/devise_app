ğŸ§¡deviseå®Ÿè£…

ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ãƒãƒ‹ãƒ¥ã‚¢ãƒ«
https://github.com/plataformatec/devise

$ rails new devise_app -d postgresql
$ cd devise_app/
$ rails g scaffold blog title:string content:text
$ code .
$ rails db:create
$ rails db:migrate

gem 'devise'
gem 'rexml' #viewsãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆç”¨
gem 'devise-i18n' => ãƒ­ã‚±ãƒ¼ãƒ«è¨­å®š
gem 'rails_admin', '~> 2.0' ç®¡ç†ç”»é¢ã‚’ä½œæˆ
gem 'cancancan' ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã®è¨­å®š
gem 'letter_opener_web' (development)

$ bundle install
$ rails g devise:install =>Deviseã‚’å°å…¥ã€ã“ã“ã§å‡ºã¦ãã‚‹ã‚¤ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã«æ²¿ã£ã¦è¨­å®š
$ rails g devise:views =>app/views/deviseã®ä¸­ã«deviseã§ä½¿ã†viewã‚’ä½œæˆ
- sessionsï¼šãƒ­ã‚°ã‚¤ãƒ³ç”»é¢
- registrationsï¼šãƒ¦ãƒ¼ã‚¶ç™»éŒ²ç”»é¢ã¨ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç·¨é›†ç”»é¢ (/users/sign_upã‚¢ã‚«ã‚¦ãƒ³ãƒˆç™»éŒ², users/editç·¨é›†ã€å‰Šé™¤ç”»é¢)
- confirmationsï¼šèªè¨¼ãƒ¡ãƒ¼ãƒ«å†é€ä¿¡ã™ã‚‹ãŸã‚ã®ç”»é¢ (new/ç¢ºèªãƒ¡ãƒ¼ãƒ«å†é€)
- passwordsï¼šãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã™ã‚‹ãŸã‚ã®ç”»é¢ (new/ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¿˜ã‚Œã¾ã—ãŸã‹ï¼Ÿ, edit/ãƒ¡ãƒ¼ãƒ«ã‹ã‚‰ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦å¤‰æ›´)
- unlocksï¼šã‚¢ã‚«ã‚¦ãƒ³ãƒˆå‡çµç”»é¢
- sharedï¼šDeviseã®ç”»é¢ã«é·ç§»ã•ã›ã‚‹ãŸã‚ã®ãƒªãƒ³ã‚¯

$ rails g devise user =>deviseã‚’ä½¿ã£ã¦Userãƒ¢ãƒ‡ãƒ«
ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã¯ãšã™ #Trackable, #Confirmable(ãƒ¡ãƒ¼ãƒ«èªè¨¼) è¿½è¨˜execute("UPDATE users SET confirmed_at = NOW()")
ã‚«ãƒ©ãƒ è¿½åŠ ã§ãã‚‹ â†“ä¾‹
t.string :name
t.string :icon
t.boolean :admin, default: false  (ã‚ã¨ã§è¿½åŠ ã—ã¦ã‚‹ã‚¢ãƒ‰ãƒŸãƒ³ã“ã“ã§è¿½åŠ ã§ãã‚‹ã‚ˆï¼)

$ rails db:migrate

ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã¯è‡ªå‹•ã§ã•ã‚Œã‚‹ãƒ»ãƒ»ãƒ»ï¼

---ãƒ¡ãƒ¼ãƒ«èªè¨¼æ©Ÿèƒ½---------------
app/models/user.rbã«ã€:confirmableè¿½è¨˜

â“ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—ã—ã¦ã‚‚ãƒ¡ãƒ¼ãƒ«ã«åˆ‡ã‚Šæ›¿ã‚ã‚‰ãªã„
/letter_openeré–‹ã„ã¦ã€ç¢ºèªã—ã¦ã€ãƒ­ã‚°ã‚¤ãƒ³ã§ã„ã„ã‚“ï¼Ÿï¼Ÿ
sendgridã‚„ã£ã¦ã¿ã‚‹

---admin--------------------------
usersãƒ†ãƒ¼ãƒ–ãƒ«ã«booleanå‹ã®adminã‚«ãƒ©ãƒ ã‚’è¿½åŠ 
$ rails generate migration add_admin_to_users admin:boolean
default: falseã«ã™ã‚‹ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶

if current_user.admin? ã§ã‚¢ãƒ‰ãƒŸãƒ³æ¨©é™ãŒã‚ã‚‹æ™‚ã®å®Ÿè£…ãŒã§ãã‚‹ï¼
if current_user.try(:admin?) ã§ã€if current_user? && current_user.admin? ã¨åŒã˜ã€‚

$ rails g rails_admin:install ã§ç®¡ç†ç”»é¢ä½œæˆ(gemã¨ã‚»ãƒƒãƒˆã§)
https://github.com/sferik/rails_admin
/adminã®routingãŒã§ãã‚‹ï¼ç®¡ç†ç”»é¢ã¸
config/initializers/rails_admin.rb ãŒã§ãã‚‹ã‹ã‚‰ã€ä½¿ã†gemã®éƒ¨åˆ†ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã¯ãšã™

ç®¡ç†ç”»é¢æ—¥æœ¬èªåŒ– => rails_admin.ja.ymlä½œã£ã¦ã€ä»¥ä¸‹ã‚³ãƒ”ãƒšã€‚
https://gist.github.com/mshibuya/1662352

$ rails g cancan:ability ç®¡ç†è€…æ¨©é™ãŒã‚ã‚‹ãƒ¦ãƒ¼ã‚¶ã®ã¿ç®¡ç†ç”»é¢ã«ã‚¢ã‚¯ã‚»ã‚¹
https://github.com/CanCanCommunity/cancancan
Abilityãƒ¢ãƒ‡ãƒ« models/ability.rb ãŒã§ãã‚‹
    if user.try(:admin?)
      can :access, :rails_admin
      can :manage, :all
    end
  ã“ã‚Œã‚’è¿½åŠ ã—ã¦ã€ã‚¢ã‚¯ã‚»ã‚¹åˆ¶é™

--Send Grid---------------------------------
